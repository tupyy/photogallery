(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{125:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),l=a(20),i=a.n(l),r=(a(90),a(11)),s=a(12),c=a(14),p=a(13),u=a(15),d=a(70),h=a.n(d),f=a(22),m=a(140),b=a(16),g=a.n(b),y=a(138),E=a(139),v=a(142),S=a(48),_="READY",C="QUEUED",O="UPLOADING",A="DONE",U="CANCELLED",L=a(145),k=a(49),j=a.n(k),x=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(p.a)(t).call(this,e))).handleClick=a.handleClick.bind(Object(f.a)(a)),a.state={showStateLog:!1},a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleClick",value:function(){this.setState(Object(S.a)({},this.state,{showStateLog:!this.state.showStateLog}))}},{key:"render",value:function(){return this.props.uploadState===A?o.a.createElement(L.a,{color:"primary",style:{backgroundColor:"green",fontWeight:"bold"},label:"Done"}):"ERROR"===this.props.uploadState?o.a.createElement("div",null,o.a.createElement(L.a,{color:"primary",style:{backgroundColor:"red",fontWeight:"bold"},label:"Error",onClick:this.handleClick}),this.state.showStateLog&&o.a.createElement("ul",{className:j.a.logContainer},o.a.createElement("li",{className:j.a.logReasonEntry},this.props.stateLog.reason),o.a.createElement("li",{className:j.a.logStatusEntry},this.props.stateLog.status))):this.props.uploadState===U?o.a.createElement(L.a,{color:"primary",style:{backgroundColor:"orange",fontWeight:"bold"},label:"Cancelled"}):o.a.createElement("div",null)}}]),t}(o.a.Component),N=a(141),B=a(21),D=0,F=function(e,t,a,n){return{type:"ADD_FILE",id:D++,fileURL:e,name:t,fileType:a,file:n}},R=function(e){return{type:"DELETE_FILE",id:e}},w=function(e){return{type:"CANCEL_UPLOAD",id:e}},P=function(e){return{type:"UPLOAD_FILE",id:e}},G=function(){return{type:"UPLOAD_ALL"}},T=function(){return{type:"CANCEL_ALL"}},I=function(){return{type:"CLEAR_ALL"}},H=function(e,t,a,n){return{type:"UPDATE_FILE_UPLOAD_PROGRESS",id:e,value:t,chunkSize:a,rawValue:n}},W=function(e,t,a){return{type:"UPDATE_FILE_UPLOAD_STATE",id:e,uploadState:t,uploadStatePayload:a}},X=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(p.a)(t).call(this,e))).isUploading=function(){return this.props.uploadState===O},a.handleDeleteButtonClick=a.handleDeleteButtonClick.bind(Object(f.a)(a)),a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleDeleteButtonClick",value:function(){this.isUploading()?this.props.cancelUpload(this.props.file.id):this.props.deleteFile(this.props.file.id)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:g.a.root},o.a.createElement(y.a,{className:g.a.paper},o.a.createElement(E.a,{container:!0,spacing:2,className:g.a.mainGrid},o.a.createElement(E.a,{item:!0},o.a.createElement("div",{className:g.a.image},o.a.createElement("img",{className:g.a.img,alt:"complex",src:this.props.file.fileURL}))),o.a.createElement(E.a,{item:!0,xs:12,sm:!0,container:!0},o.a.createElement(E.a,{item:!0,xs:!0,container:!0,direction:"column",spacing:2},o.a.createElement(E.a,{item:!0,xs:!0},o.a.createElement(m.a,{variant:"body2",gutterBottom:!0,className:g.a.filename},this.props.file.name),o.a.createElement("div",{className:g.a.progressBar},o.a.createElement(N.a,{variant:"determinate",value:this.props.completed})),o.a.createElement("div",{className:g.a.chip},o.a.createElement(x,{uploadState:this.props.uploadState,stateLog:this.props.file.stateLog}))),o.a.createElement(E.a,{item:!0},o.a.createElement("div",{className:g.a.buttonContainer},o.a.createElement(v.a,{variant:"contained",color:"primary",className:g.a.button,disabled:this.props.uploadState===A||this.props.uploadState===O,onClick:function(){return e.props.uploadFile(e.props.file.id)}},"Upload"),o.a.createElement(v.a,{variant:"contained",color:"secondary",className:g.a.button,onClick:this.handleDeleteButtonClick},this.props.uploadState===O?"Stop":"Delete"))))))))}}]),t}(o.a.Component);var M=Object(B.b)(null,function(e){return{deleteFile:function(t){e(R(t))},cancelUpload:function(t){e(w(t))},uploadFile:function(t){e(P(t))}}})(X),q=a(76),z=a.n(q),J=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("div",null,this.props.filesState.files&&this.props.filesState.files.length?this.props.filesState.files.map(function(e){return o.a.createElement(M,{key:e.id,file:e,uploadState:e.uploadState,completed:e.completed,showErrorLog:!0})}):o.a.createElement("div",{className:z.a.noFiles},o.a.createElement("p",null,"Add some images..."))))}}]),t}(o.a.Component),V=Object(B.b)(function(e){return{filesState:e.files}})(J),Y=a(62),Z=a.n(Y),Q=a(143),K=a(144),$=a(51),ee=a(35),te=function(e){return{root:{display:"flex",justifyContent:"center",marginTop:"10px",marginBottom:"10px"},button:{margin:"2px"},input:{display:"none"},rootBottom:{color:"black",labelColor:"black",width:"100%",position:"fixed",bottom:0},bottomAction:{color:"#0061ff"},icon:{fontSize:"25px",marginBottom:"10px"}}},ae=a(46),ne=a.n(ae),oe=a(64),le=a.n(oe),ie=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(p.a)(t).call(this,e))).inputRef=o.a.createRef(),a.handleClick=a.handleClick.bind(Object(f.a)(a)),a.handleChange=a.handleChange.bind(Object(f.a)(a)),a.handleOnCancelClick=a.handleOnCancelClick.bind(Object(f.a)(a)),a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleClick",value:function(e){this.inputRef.current.click()}},{key:"handleChange",value:function(e){var t=this;Array.from(e.target.files).forEach(function(e){var a=e;t.props.onAddFile(URL.createObjectURL(a),a.name,a.type,a)}),this.inputRef.current.value=""}},{key:"handleOnCancelClick",value:function(e){this.props.uploadGlobalState?this.props.onCancelAllUpload():this.props.onClearAll()}},{key:"isStopDisabled",value:function(){return this.props.hasFiles||this.props.uploadGlobalState?"":le.a.disabled}},{key:"isUploadDisabled",value:function(){return this.props.uploadGlobalState||!this.props.hasFiles?le.a.disabled:""}},{key:"getStopIcon",value:function(){return this.props.uploadGlobalState?ee.d:ee.a}},{key:"render",value:function(){var e=this.props.classes;return o.a.createElement("div",{className:e.root},o.a.createElement("input",{type:"file",name:"files[]",ref:this.inputRef,onChange:this.handleChange,multiple:!0,className:e.input}),o.a.createElement(Z.a,{minDeviceWidth:1224,device:{deviceWidth:1600}},o.a.createElement(v.a,{variant:"contained",color:"primary",onClick:this.handleClick,className:e.button},"Add"),o.a.createElement(v.a,{variant:"contained",color:"primary",className:e.button,onClick:this.props.onStartUpload,disabled:this.props.uploadGlobalState||!this.props.hasFiles},"Upload"),o.a.createElement(v.a,{variant:"contained",color:"secondary",className:e.button,disabled:!this.props.hasFiles&&!this.props.uploadGlobalState,onClick:this.handleOnCancelClick},this.props.uploadGlobalState?"Cancel":"Clear all")),o.a.createElement(Z.a,{maxDeviceWidth:1224,device:{deviceWidth:1600}},o.a.createElement(Q.a,{className:e.rootBottom,showLabels:!0,selectedIndex:"1"},o.a.createElement(K.a,{label:"Add images",labelColor:"red",className:e.bottomAction,onClick:this.handleClick,icon:o.a.createElement($.a,{icon:ee.c,className:e.icon})}),o.a.createElement(K.a,{label:"Upload",onClick:this.props.onStartUpload,className:[e.bottomAction,this.isUploadDisabled()].join(" "),disabled:this.props.uploadGlobalState||!this.props.hasFiles,icon:o.a.createElement($.a,{icon:ee.b,className:e.icon})}),o.a.createElement(K.a,{label:this.props.uploadGlobalState?"Cancel":"Clear all",className:[e.bottomAction,this.isStopDisabled()].join(" "),disabled:!this.props.hasFiles&&!this.props.uploadGlobalState,onClick:this.handleOnCancelClick,icon:o.a.createElement($.a,{icon:this.getStopIcon(),className:e.icon})}))))}}]),t}(o.a.Component);var re=Object(B.b)(function(e){return{uploadGlobalState:e.files.global.uploadGlobalState,hasFiles:e.files.files.length>0}},function(e){return{onAddFile:function(t,a,n,o){e(F(t,a,n,o))},onStartUpload:function(){e(G())},onCancelAllUpload:function(){return e(T())},onClearAll:function(){return e(I())}}})(ne()(te)(ie)),se=function(e){return{root:{},progressBar:{height:"15px"}}},ce=function(e){function t(){var e,a;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(a=Object(c.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).computeProgress=function(){return 0===this.props.uploadedBytes||0===this.props.totalBytes?0:Math.round(100*this.props.uploadedBytes/this.props.totalBytes)},a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.classes;return o.a.createElement("div",{className:e.root},o.a.createElement(N.a,{className:e.progressBar,variant:"determinate",value:this.computeProgress()}))}}]),t}(o.a.Component),pe=Object(B.b)(function(e){return{uploadGlobalState:e.files.global.uploadGlobalState,uploadedBytes:e.files.global.uploadedBytes,totalBytes:e.files.global.totalBytes}})(ne()(se)(ce)),ue=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(re,null),o.a.createElement(pe,null),o.a.createElement("div",{className:h.a.fileContainer},o.a.createElement(V,null)))}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var de=a(33),he=a(78);function fe(e){for(var t=0;t<e.files.length;t++){var a=e.files[t];if(a.uploadState===O||a.uploadState===C)return!0}return!1}var me=0,be={files:[],global:{uploadGlobalState:!1,uploadedBytes:0,totalBytes:0}};var ge=function(e,t){return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,n=arguments.length>1?arguments[1]:void 0;return t.hasOwnProperty(n.type)?t[n.type](a,n):a}}(be,{ADD_FILE:function(e,t){return Object(S.a)({},e,{files:[].concat(Object(he.a)(e.files),[{id:me++,fileURL:t.fileURL,name:t.name,fileType:t.fileType,file:t.file,completed:0,bytesUploaded:0,uploadState:_}]),global:{totalBytes:e.global.totalBytes+t.file.size,uploadedBytes:e.global.uploadedBytes,uploadGlobalState:e.global.uploadGlobalState}})},UPLOAD_FILE:function(e,t){var a={};return Object.assign(a,e),a.files.forEach(function(e){e.id===t.id&&(e.uploadState=C,e.completed=0,e.bytesUploaded=0)}),a.global.uploadGlobalState=fe(e),a},DELETE_FILE:function(e,t){var a={};return Object.assign(a,e),a.files.forEach(function(e,n){e.id===t.id&&(window.URL.revokeObjectURL(e.fileURL),a.files.splice(n,1))}),a},CANCEL_UPLOAD:function(e,t){var a={};return Object.assign(a,e),a.files.forEach(function(e){e.id===t.id&&(e.uploadState=U,a.global.uploadedBytes-=e.bytesUploaded)}),a.global.uploadGlobalState=fe(a),a},UPLOAD_ALL:function(e){var t={};return Object.assign(t,e),t.files.forEach(function(e){e.uploadState!==A&&(e.uploadState=C)}),t.global.uploadGlobalState=!0,t},CANCEL_ALL:function(e){var t={};return Object.assign(t,e),t.files.forEach(function(e){e.uploadState!==A&&(e.uploadState=U)}),t.global.uploadedBytes-=function(e,t){var a=0;return e.files.forEach(function(e){e.uploadState===t&&(a+=e.bytesUploaded)}),a}(t,U),t.global.uploadGlobalState=!1,t},UPDATE_FILE_UPLOAD_PROGRESS:function(e,t){var a={};return Object.assign(a,e),a.files.forEach(function(e){e.id===t.id&&(e.completed=t.value,e.bytesUploaded=t.rawValue)}),a.global.uploadedBytes+=t.chunkSize,a},UPDATE_FILE_UPLOAD_STATE:function(e,t){var a={};return Object.assign(a,e),a.files.forEach(function(e){e.id===t.id&&(t.uploadState===_?(e.completed=0,e.bytesUploaded=0,e.stateLog={}):(e.uploadState=t.uploadState,void 0!==t.uploadStatePayload&&(e.stateLog=t.uploadStatePayload)))}),a.global.uploadGlobalState=fe(a),a},CLEAR_ALL:function(){return be}}),ye=Object(de.b)({files:ge}),Ee=Object(de.c)(ye),ve=a(77),Se=a.n(ve);function _e(e,t,a,n){this.filename=t,this.fileType=a,this.file=n,this.id=e,this.progress=0,this.lastUploadedBytesValue=0,this.promise=void 0,this.hasBeenAborted=!1,this.xhr=void 0,this.updateUploadProgress=function(e,t,a){Ee.dispatch(H(this.id,e,t,a))},this.createXHRObject=function(e,t,a,n){var o=new XMLHttpRequest;o.open("POST",t,!0),o.setRequestHeader("Content-Type","application/json");var l=document.getElementsByName("csrfmiddlewaretoken");return void 0!==l[0]&&o.setRequestHeader("X-CSRFToken",l[0].value),o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&200===o.status?a(o.responseText):404===o.status&&n({id:e,reason:o.statusText,status:o.status})},o}}_e.prototype.send=function(e,t){var a=this;return this.promise=new Promise(function(n,o){a.sign(e).then(function(e){return e}).then(function(e){var t=JSON.parse(e);return a.uploadFile(t.url)}).catch(function(e){console.log(e),o(e)}).then(function(){return a.save(t)}).catch(function(e){console.log(e),o(e)}).then(function(){n(a.id)})}),this.promise},_e.prototype.abort=function(){this.hasBeenAborted=!0,this.xhr.abort()},_e.prototype.uploadFile=function(e){var t=this,a=this;return new Promise(function(n,o){a.xhr=new XMLHttpRequest,a.xhr.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);a.updateUploadProgress(t,e.loaded-a.lastUploadedBytesValue,e.loaded),a.lastUploadedBytesValue=e.loaded}}),a.xhr.onreadystatechange=function(){4===a.xhr.readyState&&(200===a.xhr.status||204===a.xhr.status?n(a.id):o({id:a.id,reason:a.xhr.statusText,status:a.xhr.status}))},a.xhr.open("PUT",e,!0),a.xhr.setRequestHeader("Content-type",t.fileType),a.xhr.overrideMimeType(t.fileType),a.xhr.send(t.file)})},_e.prototype.sign=function(e){var t=this;return new Promise(function(a,n){t.xhr=t.createXHRObject(t.id,e,a,n),t.xhr.send(JSON.stringify({filename:t.filename,filetype:t.fileType}))})},_e.prototype.save=function(e){var t=this;return new Promise(function(a,n){t.xhr=t.createXHRObject(t.id,e,a,n),t.xhr.send(JSON.stringify({filename:t.filename}))})};var Ce=_e;function Oe(){this.maxConcurrentUploads=1,this.slots={},this.updateUploadState=function(e,t,a){Ee.dispatch(W(e,t,a))},this.get_album_id=function(){var e=window.location.href.split("/");return e[e.length-1]}}Oe.prototype.subscribe=function(){var e=this,t=Se()(Ee.getState,"files");Ee.subscribe(t(function(t){e.onStateChange(t)}))},Oe.prototype.hasFreeSlot=function(){return Object.keys(this.slots).length<this.maxConcurrentUploads},Oe.prototype.onStateChange=function(e){var t=this;e.files.forEach(function(e){if(e.uploadState!==C||t.slots.hasOwnProperty(e.id)){if(e.uploadState===U&&t.slots.hasOwnProperty(e.id)){t.slots[e.id].abort()}}else if(t.hasFreeSlot()){var a=new Ce(e.id,e.name,e.fileType,e.file);t.slots[e.id]=a,t.updateUploadState(e.id,O),a.send("/album/sign-s3/"+t.get_album_id(),"/album/upload/"+t.get_album_id()).then(function(e){delete t.slots[e],t.updateUploadState(e,A)}).catch(function(e){console.log(e);var a=!0===t.slots[e.id].hasBeenAborted?U:"ERROR";delete t.slots[e.id],t.updateUploadState(e.id,a,e)})}})};var Ae=Oe,Ue=document.getElementById("root"),Le=new Ae,ke=function(){return i.a.render(o.a.createElement(B.a,{store:Ee},o.a.createElement(ue,null)),Ue)};ke(),Ee.subscribe(ke),Le.subscribe(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},16:function(e,t,a){e.exports={root:"FileUI_root__iuAMa",mainGrid:"FileUI_mainGrid__3P4S0",buttonContainer:"FileUI_buttonContainer__2Dbyr",button:"FileUI_button__2fRYk",paper:"FileUI_paper__3XNAi",filename:"FileUI_filename__2GX8Z",image:"FileUI_image__3ZwOl",img:"FileUI_img__Dqx9r",chip:"FileUI_chip__14dBY"}},49:function(e,t,a){e.exports={logContainer:"StateChip_logContainer__3pvbE",logReasonEntry:"StateChip_logReasonEntry__201bd",logStatusEntry:"StateChip_logStatusEntry__10WiS"}},64:function(e,t,a){e.exports={disabled:"MainController_disabled__3nDOZ"}},70:function(e,t,a){e.exports={App:"App_App__3skpS","App-logo":"App_App-logo__T4I_X","App-logo-spin":"App_App-logo-spin__26bxB","App-header":"App_App-header__399rB","App-link":"App_App-link__1uIQ2",fileContainer:"App_fileContainer__3lNUK",bottomComponent:"App_bottomComponent__2epST",mainController:"App_mainController__2PHmx"}},76:function(e,t,a){e.exports={noFiles:"FileUIContainer_noFiles__2PzAS"}},85:function(e,t,a){e.exports=a(125)},90:function(e,t,a){}},[[85,1,2]]]);
//# sourceMappingURL=main.1eb52c31.chunk.js.map